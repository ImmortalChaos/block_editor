
<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="Expires" content="-1">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-cache">
	<title>블록 에디터 예제</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap-theme.min.css">
	<style type="text/css">
	.editor_toolbar {
		position:absolute;
		display:none;
		padding:5px;
		height:47px;
		box-shadow:-3px 0 0 0 #555d66;
		border-left: none;
		border-top:1px solid #b5bcc2;
		border-right:1px solid #b5bcc2;
		background-color: #ffffff;
		transform: translateY(-47px) translateX(0px);
	}
	.editor_board {
		padding-top:30px;
		width:100%;
		height:100%;
		min-height:480px;
	}
	.editor_toolbar_slot {
		border: 1px solid #b5bcc2;
		display: inline-flex;
	}
	.editor_menu {
		height:20px;
		border:1px solid #333333;
		border-left:none;
	}
	.editor_block {
		max-width:610px;
		box-sizing: border-box;
	}
	.editor_block_layout {
		padding-left:3px;
		padding-right:3px;
	}
	.editor_styles_wrapper {
		font-family: 'Noto Serif';
		font-size: 16px;
		line-height: 1.8;
		color: #191e23;
	}
	.is-selected{
		box-shadow: -3px 0 0 0 #555d66;
		outline-color:#b5bcc2;
		outline-style: solid;
		outline-width: 1px;
		outline-offset: -1px;
		/*border:1px solid #b5bcc2;
		border-left: none;*/
	}
	.editor-block-mover {
		position:absolute;
		left: -38px;
		top: 42px;
		background: #fff;
		min-height: 56px;
		border: 1px solid rgba(66,88,99,.4);
		border-radius: 4px;
		transition: box-shadow .2s ease-out;
	}
	.editor-block-mover__control {
		border: none;
		background: none;
	}
	.block-editor-block-mover__control {
		border: none;
		width: 28px;
		height:24px;
		display:flex;
		align-items: center;
		text-align: center;
		justify-content: center;
		font-family: "Noto Serif";
	}
	.block-editor-block-mover__control-drag-handle {
		cursor: grab;
		fill: currentColor;
	}
	/**:focus {
		outline: none;
	}*/
	</style>
	<script>
		function hideToolBar() {	
			$('.editor_toolbar').css("display", "none");
			$('.editor_block').removeClass('is-selected');
			console.log('called hideToolBar')
		}
		$(document).ready(function(){
			$('.editor_board').bind('click', function(e) {
				if($(e.target).hasClass('editor_board')) {
					hideToolBar();				
				}
			});
			$('.editor_block').bind('focus', function(e){
				$('.editor_toolbar').css("display", "none");
				$('.editor_block').removeClass('is-selected');
				$(this).addClass('is-selected'); 
				console.log(e);

				// 왼쪽 이동바의 위치를 텍스트 영역 높이에 맞춰 보정한다.
				var myHeight = $(this)[0].getBoundingClientRect().height;
				var centerPosition = (myHeight<72)?(42 - (72 - myHeight)/2):42;

				$('.editor_toolbar').offset({top:$(this).offset().top});
				$('.editor_toolbar').css("display", "block");
				$('.editor-block-mover').css("top", centerPosition + "px");
				console.log($(this)[0].getBoundingClientRect());
				console.log($(this).offset().top);
				console.log();
			});
			$('.editor_block').bind('change', function(e){
				console.log('size changed!');
			});
			$('.btn').bind('focus', function(){
				console.log("button");
			});
			$('.btn').bind('click', function(){
				console.log($(this)[0].id);
				const selection = window.getSelection();
				const range = selection.getRangeAt(0);
				const elemId = $(this)[0].id;
				if(elemId==="setbold") {
					document.execCommand('bold',false,null);
				} else if(elemId==="setitalic") {
					document.execCommand('italic',false,null);					
				}
				console.log(range);
				console.log("button::click");
			});			
			$('.container').bind('focus', function(){
				hideToolBar();
			});
		});
	</script>
</head>
<body>
	<div class="container">
		<div>Edit Document :</div>
		<div>&nbsp;</div>
		<div class="editor_board">
			<div class="editor_toolbar">
				<div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups">
				  <div class="btn-group" role="group">
					<button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					  )(
					</button>
					<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
					  <a class="dropdown-item" href="#">A</a>
					  <a class="dropdown-item" href="#">B</a>
					</div>
				  </div>
				  <div class="btn-group mr-2" role="group" aria-label="Third group">
				    <button type="button" class="btn btn-secondary">H1</button>
				    <button type="button" class="btn btn-secondary">정렬</button>
				  </div>
				  <div class="editor-block-mover block-editor-block-mover is-visible">
				  	<button type="button" aria-label="위로 이동" aria-disabled="false" class="editor-block-mover__control block-editor-block-mover__control"><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" role="img" aria-hidden="true" focusable="false"><polygon points="9,4.5 3.3,10.1 4.8,11.5 9,7.3 13.2,11.5 14.7,10.1 "></polygon></svg></button>
				  	<div class="editor-block-mover__control-drag-handle block-editor-block-mover__control-drag-handle editor-block-mover__control block-editor-block-mover__control" aria-hidden="true" draggable="true"><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" role="img" aria-hidden="true" focusable="false"><path d="M13,8c0.6,0,1-0.4,1-1s-0.4-1-1-1s-1,0.4-1,1S12.4,8,13,8z M5,6C4.4,6,4,6.4,4,7s0.4,1,1,1s1-0.4,1-1S5.6,6,5,6z M5,10 c-0.6,0-1,0.4-1,1s0.4,1,1,1s1-0.4,1-1S5.6,10,5,10z M13,10c-0.6,0-1,0.4-1,1s0.4,1,1,1s1-0.4,1-1S13.6,10,13,10z M9,6 C8.4,6,8,6.4,8,7s0.4,1,1,1s1-0.4,1-1S9.6,6,9,6z M9,10c-0.6,0-1,0.4-1,1s0.4,1,1,1s1-0.4,1-1S9.6,10,9,10z"></path></svg></div>
				  	<button type="button" aria-label="아래로 이동" aria-disabled="false" class="editor-block-mover__control block-editor-block-mover__control"><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" role="img" aria-hidden="true" focusable="false"><polygon points="9,13.5 14.7,7.9 13.2,6.5 9,10.7 4.8,6.5 3.3,7.9 "></polygon></svg></button>
				  </div>


				  <div class="btn-group mr-2" role="group" aria-label="four group">
				    <button id="setbold" type="button" class="btn btn-secondary" data-toggle="button" aria-pressed="false">B</button>
				    <button id="setitalic" type="button" class="btn btn-secondary" data-toggle="button" aria-pressed="false">I</button>
				    <button type="button" class="btn btn-secondary">...</button>
				  </div>
				</div>
			</div>
		    <div contentEditable="true" class="editor_block editor_block_layout editor_styles_wrapper"><div class="bbb">This text can be edited by the user.</div></div>
		    <div contentEditable="true" class="editor_block editor_block_layout editor_styles_wrapper input">
		      This text can be edited by the user.
		    </div>
	    </div>
	</div>
  </body>
</html> 


